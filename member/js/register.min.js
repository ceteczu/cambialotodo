var TT_NS=function(c,a){c.isEmail=function(a){return/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/.test(a)};c.check={CharMode:function(a){return 48<=a&&57>=a?1:65<=a&&90>=a?2:97<=a&&122>=a?4:8},bitTotal:function(a){for(i=modes=0;4>i;i++)a&1&&modes++,a>>>=1;return modes},checkStrong:function(a){if(5>=a.length)return 0;for(i=Modes=0;i<a.length;i++)Modes|=this.CharMode(a.charCodeAt(i));return this.bitTotal(Modes)},passLevel:function(b){O_color="#f5f5f5";L_color="#ff5544";M_color="#ffbd00";H_color="#90c83d";if(null==b||""==b)a(".bm_psw_leve").hide(),Lcolor=Mcolor=Hcolor=O_color,a(".first").css("background",Lcolor),a(".second").css("background",Mcolor),a(".last").css("background",Hcolor);else switch(S_level=this.checkStrong(b),a(".bm_psw_leve").show(),S_level){case 0:Lcolor=Mcolor=Hcolor=O_color,a(".first").css("background",Lcolor),a(".second").css("background",Mcolor),a(".last").css("background",Hcolor);case 1:Lcolor=L_color;Mcolor=Hcolor=O_color;a(".first").css("background",Lcolor);a(".second").css("background",Mcolor);a(".last").css("background",Hcolor);break;case 2:Lcolor=L_color;Mcolor=M_color;Hcolor=O_color;a(".first").css("background",Lcolor);a(".second").css("background",Mcolor);a(".last").css("background",Hcolor);break;default:Lcolor=L_color,Mcolor=M_color,Hcolor=H_color,a(".first").css("background",Lcolor),a(".second").css("background",Mcolor),a(".last").css("background",Hcolor)}}};(function(){a(".m_dialog_login .bm_tab_but li").click(function(){var b=a(this).index();a(this).addClass("cur").siblings().removeClass("cur");a(".m_login_c").children(".login_box").eq(b).show().siblings().not(".other_login").hide()})})();a("#signIn").click(function(){TT_NS.dialog.dialogBg();var b=a(window).height();a(".m_dialog_login").addClass("dialog_show");a(".m_dialog_login .dialog_body").css({"max-height":b-100})});c.login={ajaxFlag:!0,loginErrCount:0,showError:function(b,c){a(b).parents(".m_text").addClass("error");a(b).parent().siblings("p").text(c)},unshowError:function(b){a(b).parents(".m_text").removeClass("error")},showSucess:function(){a(".m_text").addClass("sucess")},inputFocus:function(b){a(b+" input").focus(function(){c.login.unshowError(a(this))});return this},inputKeyup:function(b){a(b+" input").keyup(function(){c.login.unshowError(a(this))});return this},inputBlur:function(b){a(b+" input").blur(function(){if(""==a(this).val()){var b="email"==a(this).attr("name")?TT_NS.lang.getLangForKey("message.enterYourEmail"):"pw"==a(this).attr("name")?TT_NS.lang.getLangForKey("account.providePassword","Provide a password"):"cpw"==a(this).attr("name")?TT_NS.lang.getLangForKey("account.confirmPassEmpty","Repeat your password"):"code"==a(this).attr("name")?TT_NS.lang.getLangForKey("account.enterCaptcha","Please enter the captcha"):TT_NS.lang.getLangForKey("message.cannotBeEmpty");c.login.showError(a(this),b)}else"email"==a(this).attr("name")&&(b=a.trim(a(this).val()),c.isEmail(b)||(b=TT_NS.lang.getLangForKey("message.wrongEmail"),c.login.showError(a(this),b)))});return this},getData:function(){var b=this;b.ajaxFlag=!1;var d=a("#login-form").serializeArray();a.ajax({type:"POST",url:"/member/userlogin",data:d,dataType:"json",success:function(d){if(1==d.ret)c.login.showSucess(),window.location.href=d.backUrl;else{var e=a(".code").find("img");0<e.length&&e.click();"-1005"==d.errCode||"-1111"==d.errCode?c.login.showError("input[name\x3d'email']",d.msg):"-1004"==d.errCode?c.login.showError("input[name\x3d'pw']",d.msg):"-1001"==d.errCode?c.login.showError("input[name\x3d'code']",d.msg):c.login.showError("input[name\x3d'pw']",d.msg);c.login.loginErrCount+=1;2<c.login.loginErrCount&&window.location.reload()}setTimeout(function(){b.ajaxFlag=!0;console.log(b.ajaxFlag)},1E3)}})},checkInput:function(b){b=a(b).serializeArray();a.each(b,function(a,b){if(!b.value){var d="email"==b.name?TT_NS.lang.getLangForKey("message.enterYourEmail"):"pw"==b.name?TT_NS.lang.getLangForKey("account.providePassword","Provide a password"):"cpw"==b.name?TT_NS.lang.getLangForKey("account.confirmPassEmpty","Repeat your password"):"code"==b.name?TT_NS.lang.getLangForKey("account.enterCaptcha","Please enter the captcha"):TT_NS.lang.getLangForKey("message.cannotBeEmpty");c.login.showError("input[name\x3d'"+b.name+"']",d)}})},loginPost:function(){this.checkInput("#login-form");0==a("#login-form").find(".error").length&&this.getData()},bindEvent:function(){var b=this;a("#login-form").find(".signIn_btn").on("click",function(){b.ajaxFlag&&b.loginPost()});return this},keydownEnter:function(){var b=this;a("body").on("keyup",function(c){13==c.which&&0<a("#login-form").length&&b.ajaxFlag&&b.loginPost()});return this},init:function(){a(".forget_psw").click(function(b){b.preventDefault();b=a(this).attr("href");var c=a("input[name\x3d'email']").val();window.location.href=b+"?em\x3d"+TT_NS.base64.base64Encode(c)});this.inputFocus(".login_box").inputKeyup(".login_box").inputBlur("#login-form").bindEvent().keydownEnter()}};c.register={ajaxFlag:!0,registerPost:function(){c.login.checkInput("#register-form");1==a("#agreee").prop("checked")?a("#agreee").parents(".agress_c").removeClass("error"):a("#agreee").parents(".agress_c").addClass("error");0==a("#register-form").find(".error").length&&this.getData()},bindEvent:function(){var b=this;a("#register-form").find(".signIn_btn").on("click",function(){b.ajaxFlag&&b.registerPost()});a('#register-form input[name\x3d"pw"]').keyup(function(){c.check.passLevel(a(this).val());if(20<a(this).val().length){var b=TT_NS.lang.getLangForKey("account.enterCharacters","Please enter no more than 20 characters!");c.login.showError(a(this),b)}});return this},inputBlur:function(b){a(b+" input").blur(function(){if(""==a(this).val()){var b="email"==a(this).attr("name")?TT_NS.lang.getLangForKey("message.enterYourEmail"):"pw"==a(this).attr("name")?TT_NS.lang.getLangForKey("account.providePassword","Provide a password"):"cpw"==a(this).attr("name")?TT_NS.lang.getLangForKey("account.confirmPassEmpty","Repeat your password"):"code"==a(this).attr("name")?TT_NS.lang.getLangForKey("account.enterCaptcha","Please enter the captcha"):TT_NS.lang.getLangForKey("message.cannotBeEmpty");c.login.showError(a(this),b)}else if("email"==a(this).attr("name"))b=a.trim(a(this).val()),c.isEmail(b)||(b=TT_NS.lang.getLangForKey("message.wrongEmail"),c.login.showError(a(this),b));else if("pw"==a(this).attr("name"))b=a(this).val(),6>b.length&&""!==b&&(b=TT_NS.lang.getLangForKey("account.enter6Characters","Please enter at least 6 characters!"),c.login.showError(a(this),b));else if("cpw"==a(this).attr("name")){var b=TT_NS.lang.getLangForKey("account.enterPasswordAbove","Enter the same password as above!"),e=a("input[name\x3d'pw']").val(),f=a(this).val();e!==f&&c.login.showError(a(this),b)}});return this},getData:function(){var b=this;b.ajaxFlag=!1;var d=a("#register-form").serializeArray(),e=a("input[name\x3demail]").val();a.ajax({type:"POST",url:"/member/register",data:d,dataType:"json",success:function(d){if(1==d.ret)c.login.showSucess(),1==request("isBuynow")&&""!=request("backUrl")?window.location.href=TT_NS.base64.base64Decode(request("backUrl")):window.location.href=TT_CONFIG.userLangUrl+"/success/regsuccess?em\x3d"+TT_NS.base64.base64Encode(e);else{var f=a(".code").find("img");0<f.length&&f.click();"-1005"==d.errCode||"-1010"==d.errCode||"-1011"==d.errCode?c.login.showError("input[name\x3d'email']",d.msg):"-1004"==d.errCode?c.login.showError("input[name\x3d'pw']",d.msg):"-1001"==d.errCode?c.login.showError("input[name\x3d'code']",d.msg):c.login.showError("input[name\x3d'email']",d.msg)}setTimeout(function(){b.ajaxFlag=!0;console.log(b.ajaxFlag)},1E3)}})},keydownEnter:function(){var b=this;a("body").on("keyup",function(c){13==c.which&&0<a("#register-form").length&&b.registerPost()});return this},init:function(){this.inputBlur("#register-form").bindEvent().keydownEnter()}};c.forgetpass={init:function(){this.bindEvent();c.login.inputBlur("#forget_pass_form")},bindEvent:function(){var b=this;a("#forget_pass_form").find(".signIn_btn").on("click",function(){c.login.checkInput("#forget_pass_form");0==a("#forget_pass_form").find(".error").length&&b.getData()})},getData:function(){var b=a("#forget_pass_form").serializeArray(),d=a("input[name\x3demail]").val();a.ajax({type:"POST",url:"/member/forgetpass",data:b,dataType:"json",success:function(a){1==a.ret?(c.login.showSucess(),window.location.href=TT_CONFIG.userLangUrl+"/success/emailsuccess?em\x3d"+TT_NS.base64.base64Encode(d)):"-1005"==a.errCode||"-1010"==a.errCode||"-1011"==a.errCode||"-1204"==a.errCode?c.login.showError("input[name\x3d'email']",a.msg):"-1004"==a.errCode||"-1207"==a.errCode?c.login.showError("input[name\x3d'pw']",a.msg):"-1001"==a.errCode?c.login.showError("input[name\x3d'code']",a.msg):c.login.showError("input[name\x3d'email']",a.msg)}})}};c.changepass={init:function(){this.bindEvent();c.register.inputBlur("#change_pass_form")},bindEvent:function(){var b=this;a("#change_pass_form").find(".signIn_btn").on("click",function(){c.login.checkInput("#change_pass_form");0==a("#change_pass_form").find(".error").length&&b.getData()});a('#change_pass_form input[name\x3d"pw"]').keyup(function(){c.check.passLevel(a(this).val());if(20<a(this).val().length){var b=TT_NS.lang.getLangForKey("account.enterCharacters","Please enter no more than 20 characters!");c.login.showError(a(this),b)}})},getData:function(){var b=a("#change_pass_form").serializeArray();a.ajax({type:"POST",url:"/member/changepass",data:b,dataType:"json",success:function(a){1==a.ret?(c.login.showSucess(),window.location.href=TT_CONFIG.userLangUrl+"/"):"-1005"==a.errCode||"-1010"==a.errCode||"-1011"==a.errCode?c.login.showError("input[name\x3d'email']",a.msg):"-1004"==a.errCode||"-1207"==a.errCode?c.login.showError("input[name\x3d'pw']",a.msg):"-1001"==a.errCode?c.login.showError("input[name\x3d'code']",a.msg):c.login.showError("input[name\x3d'pw']",a.msg)}})}};c.track_order={init:function(){a("#order_track_search").find("input").focus(function(){a("#order_track_search").find("span.error").remove()});c.login.inputFocus("#order_track_search").inputBlur("#order_track_search");this.bindEvent()},bindEvent:function(){a(".order_track_submit").on("click",function(){0==a("#order_track_search").find(".error").length&&a("#order_track_search").submit()})}};c.emailActive={countTimer:null,times:a(".m_sucess_info .time_tips span").attr("data-count"),init:function(){var b=this;a(".send_email_active").on("click",function(){b.sendEmail(a(this))});a(".send_forget_email").on("click",function(){b.sendForgetEmail(a(this))})},sendForgetEmail:function(b){var c=this,e=b.attr("data-email");a.ajax({type:"POST",url:"/member/forgetpass",dataType:"json",data:{email:e},success:function(a){1==a.ret?c.count(b):TT_NS.dialog.alert({content:a.msg,btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0})}})},sendEmail:function(b){var c=this,e=b.attr("data-email");a.ajax({type:"POST",url:"/account/sendemail",dataType:"json",data:{email:e},success:function(a){1==a.ret?c.count(b):TT_NS.dialog.alert({content:a.msg,btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0})}})},downCount:function(b){var c=this;this.countTimer=setInterval(function(){b--;a(".time_tips").find("span").text(b);0>=b&&(b=0,a(".send_email_active").attr("disabled",!1),a(".send_email_active").parents(".text_btn").next(".time_tips").hide(),clearInterval(c.countTimer))},1E3)},count:function(b){b.attr("disabled",!0);b.parents(".text_btn").next(".time_tips").show();clearInterval(this.countTimer);a(".time_tips").find("span").text(this.times);this.downCount(this.times)}};c.login.init();c.register.init();c.forgetpass.init();c.changepass.init();c.track_order.init();c.emailActive.init();return c}(window.TT_NS||{},jQuery);